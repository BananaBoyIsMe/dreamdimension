{% extends 'dreambooks/base.html' %}
{% block title %}Log in â€” Dream Dimension{% endblock %}

{% block content %}
<section class="auth-section">
  <div class="auth-card">
    <header class="auth-header">
      <h2>Welcome back</h2>
      <p class="muted">Sign in to continue exploring the forest.</p>
    </header>

    <form method="post" novalidate>
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="form-errors">{{ form.non_field_errors }}</div>
      {% endif %}

      {% for field in form.visible_fields %}
        {% if field.name == "password" %}
          <div class="form-row pw-field{% if field.errors %} has-error{% endif %}">
            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
            <div class="pw-input-wrap">
              {{ field }}
              <button type="button" class="pw-toggle" aria-label="Show password">Show</button>
            </div>
            {% for err in field.errors %}
              <p class="field-error">{{ err }}</p>
            {% endfor %}
          </div>
        {% else %}
          <div class="form-row{% if field.errors %} has-error{% endif %}">
            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
            {{ field }}
            {% for err in field.errors %}
              <p class="field-error">{{ err }}</p>
            {% endfor %}
          </div>
        {% endif %}
      {% endfor %}

      <div class="form-row">
        <label class="muted"><input type="checkbox" name="remember"> Remember me</label>
      </div>

      <div class="form-actions">
        <button class="btn-primary" type="submit">Log in</button>
        <a class="btn-ghost" href="{% url 'signup' %}">Create account</a>
      </div>

      <p style="margin-top:12px;color:var(--muted)">
        <a href="{% url 'password_reset' %}" style="color:var(--muted)">Forgot password?</a>
      </p>
    </form>
  </div>
</section>

<script>
(() => {
  const pw = document.querySelector('[name="password"]');
  const toggle = document.querySelector('.pw-toggle');
  if (!pw || !toggle) return;
  toggle.addEventListener('click', () => {
    if (pw.type === 'password') { pw.type = 'text'; toggle.textContent = 'Hide'; }
    else { pw.type = 'password'; toggle.textContent = 'Show'; }
  });
})();
</script>
{% endblock %}